# Lab 8 - TypeScript

Это TypeScript версия проекта Lab 8, который изначально был написан на Go.

## Установка зависимостей

```bash
npm install
```

## Сборка проекта

```bash
npm run build
```

## Запуск тестов

Для запуска тестов в Windows:
```bash
npm test
```

Для запуска тестов в WSL (рекомендуется):
```bash
npm run test:wsl
```

Для запуска отдельных тестов в WSL (наиболее стабильный способ):
```bash
# Запустить только тесты добавления продукта
npm run test:add

# Запустить только тесты удаления продукта
npm run test:delete

# Запустить только тесты редактирования продукта
npm run test:edit

# Запустить быстрые тесты валидации
npm run test:validation

# Запустить тесты на пограничные значения
npm run test:boundary

# Запустить тесты на невалидные значения
npm run test:invalid

# Запустить тесты генерации алиасов
npm run test:alias

# Запустить быстрый тест алиасов
npm run test:quick-alias
```

### Информация о таймаутах и исправления для WSL

Тесты используют реальный API, поэтому для их выполнения требуется больше времени, чем стандартный таймаут Jest (5 секунд). Для решения проблем таймаута были внесены следующие изменения:

1. Увеличены таймауты для каждого теста до 120 секунд (в WSL)
2. Добавлен глобальный таймаут в jest.config.js (30 секунд)
3. Добавлен таймаут для запросов axios (20 секунд)
4. Для запуска в WSL создан отдельный конфигурационный файл (jest.wsl.config.js) с:
   - Увеличенным таймаутом до 180 секунд
   - Последовательным выполнением тестов (maxWorkers: 1)
   - Принудительным выходом после завершения (forceExit: true)
   - Повторными попытками для неудачных тестов (retry: 1)

Дополнительные оптимизации тестов:
1. Упрощены тесты - вместо запуска всех тестовых случаев запускаются только ключевые тесты
2. Добавлены повторные попытки выполнения запросов (до 3-х раз)
3. Добавлены подробные логи для отладки
4. Уменьшено количество API-вызовов в каждом тесте

Если тесты всё равно падают по таймауту, рекомендуется:
1. Проверить, что сервер API доступен и работает корректно (http://shop.qatl.ru)
2. Убедиться, что ваше WSL имеет достаточно ресурсов (память и процессорное время)
3. Использовать команды для запуска отдельных тестов (test:add, test:delete или test:edit)
4. Проверить сетевое соединение между WSL и внешним API

## Запуск примера использования API

```bash
npm start
```

## Структура проекта

- `src/model/` - модели данных
- `src/api/` - API для работы с сервером
- `src/tests/` - тесты

### Тесты

В проекте реализованы следующие группы тестов:

1. **Основные функциональные тесты**:
   - `addproduct.test.ts` - тесты создания продуктов
   - `deleteproduct.test.ts` - тесты удаления продуктов
   - `editproduct.test.ts` - тесты редактирования продуктов

2. **Тесты валидации**:
   - `validation.test.ts` - полный набор тестов на пограничные и невалидные значения
   - `quick-validation.test.ts` - упрощенная версия тестов валидации для быстрого запуска в WSL

3. **Тесты алиасов**:
   - `alias.test.ts` - полный набор тестов на генерацию и уникальность алиасов
   - `quick-alias.test.ts` - упрощенная версия тестов алиасов

4. **Утилитарные функции**:
   - `utils.ts` - содержит функции для проверки продуктов:
     - `assertProductEquals()` - проверяет, что все поля продукта соответствуют ожидаемым значениям
     - `assertProductValid()` - проверяет, что продукт соответствует правилам валидации
     - `assertValidAlias()` - проверяет, что алиас был сформирован правильно

Тесты валидации проверяют следующие ограничения полей:
- **category_id**: диапазон значений от 1 до 15
- **status**: разрешенные значения 0 и 1
- **hit**: разрешенные значения 0 и 1
- **price** и **old_price**: допустимость отрицательных значений
- Ограничения на длину строковых полей

## Известные проблемы

* Нет проверки на range у полей status, hit
* Можно создать продукт с отрицательной ценой
* CategoryID неправильно валидируется:
  * При создании продукта с category_id=15, его невозможно извлечь
  * Можно создать продукт с category_id=16, что не соответствует спецификации 